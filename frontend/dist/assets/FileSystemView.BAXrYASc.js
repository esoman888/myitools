import{r as m,c as te,o as oe,b as D,d as u,e as l,w as o,f as d,A as ae,B as se,g as k,E as r,k as ne,l as ie,m as f,p as n,i as c,q as re,F as ue,j as de,v as B,s as me,y as fe,C as ce,D as pe,G as _e,h as ve,H as we,z as P}from"./index.BWLkA7o2.js";const ye={class:"flex items-center mb-4"},ge={class:"bg-white rounded-lg shadow-md p-6"},ke={class:"flex items-center justify-between mb-4"},be={class:"flex items-center"},Ce={class:"flex items-center space-x-2"},xe=["onClick"],ze={class:"dialog-footer"},Fe={class:"dialog-footer"},$e={__name:"FileSystemView",setup(Te){ne();const N=ie(),p=m("/"),V=m([]),x=m(!1),_=m(!1),v=m(!1),b=m([]),z=m(!1),C=m(""),R=m(null),j=te(()=>{if(p.value==="/")return[];const t=p.value.split("/").filter(s=>s),e=[];let i="";for(const s of t)i+="/"+s,e.push({name:s,fullPath:i});return e}),E={"/":[{name:"Documents",type:"folder",size:0,modifiedTime:"2023-12-01 10:30:00"},{name:"Photos",type:"folder",size:0,modifiedTime:"2023-12-01 09:15:00"},{name:"Music",type:"folder",size:0,modifiedTime:"2023-11-30 14:20:00"},{name:"config.plist",type:"file",size:2048,modifiedTime:"2023-12-01 08:45:00"}],"/Documents":[{name:"readme.txt",type:"file",size:1024,modifiedTime:"2023-12-01 10:30:00"},{name:"data.json",type:"file",size:4096,modifiedTime:"2023-12-01 09:20:00"}],"/Photos":[{name:"IMG_001.jpg",type:"file",size:2048576,modifiedTime:"2023-12-01 09:15:00"},{name:"IMG_002.jpg",type:"file",size:1536e3,modifiedTime:"2023-12-01 09:10:00"}]},F=async(t="/")=>{x.value=!0;try{await new Promise(e=>setTimeout(e,500)),V.value=E[t]||[],p.value=t}catch(e){r.error("加载文件列表失败: "+e.message)}finally{x.value=!1}},T=t=>{F(t)},$=t=>{if(t.type==="folder"){const e=p.value==="/"?`/${t.name}`:`${p.value}/${t.name}`;T(e)}},G=t=>{$(t)},w=()=>{F(p.value)},U=()=>{_.value=!0,b.value=[]},S=async()=>{const{value:t}=await P.prompt("请输入文件夹名称","新建文件夹",{confirmButtonText:"确定",cancelButtonText:"取消"}).catch(()=>({value:null}));t&&(r.success(`文件夹 "${t}" 创建成功`),w())},I=(t,e)=>{b.value=e},L=async()=>{if(b.value.length===0){r.warning("请选择要上传的文件");return}z.value=!0;try{await new Promise(t=>setTimeout(t,2e3)),r.success("文件上传成功"),_.value=!1,w()}catch(t){r.error("文件上传失败: "+t.message)}finally{z.value=!1}},q=async t=>{try{r.info(`开始下载 "${t.name}"`)}catch(e){r.error("文件下载失败: "+e.message)}},A=t=>{R.value=t,C.value=t.name,v.value=!0},H=async()=>{if(!C.value.trim()){r.warning("请输入新的文件名");return}try{r.success("重命名成功"),v.value=!1,w()}catch(t){r.error("重命名失败: "+t.message)}},K=async t=>{if(await P.confirm(`确定要删除 "${t.name}" 吗？`,"确认删除",{confirmButtonText:"删除",cancelButtonText:"取消",type:"warning"}).catch(()=>!1))try{r.success("删除成功"),w()}catch(i){r.error("删除失败: "+i.message)}},J=t=>{if(t===0)return"0 B";const e=1024,i=["B","KB","MB","GB","TB"],s=Math.floor(Math.log(t)/Math.log(e));return parseFloat((t/Math.pow(e,s)).toFixed(2))+" "+i[s]},O=()=>{N.push("/")};return oe(()=>{F()}),(t,e)=>{const i=d("el-icon"),s=d("el-button"),h=d("el-breadcrumb-item"),Q=d("el-breadcrumb"),y=d("el-table-column"),W=d("el-table"),X=d("el-upload"),M=d("el-dialog"),Y=d("el-input"),Z=d("el-form-item"),ee=d("el-form"),le=se("loading");return f(),D("div",null,[u("div",ye,[l(s,{onClick:O,type:"default",size:"small",class:"mr-2"},{default:o(()=>[l(i,null,{default:o(()=>[l(c(re))]),_:1}),e[6]||(e[6]=n(" 返回 ",-1))]),_:1}),e[7]||(e[7]=u("h2",{class:"text-2xl font-bold"},"文件系统",-1))]),u("div",ge,[u("div",ke,[u("div",be,[l(Q,{separator:"/"},{default:o(()=>[l(h,{onClick:e[0]||(e[0]=a=>T("/"))},{default:o(()=>[...e[8]||(e[8]=[n("根目录",-1)])]),_:1}),(f(!0),D(ue,null,de(j.value,(a,g)=>(f(),k(h,{key:g,onClick:Be=>T(a.fullPath)},{default:o(()=>[n(B(a.name),1)]),_:2},1032,["onClick"]))),128))]),_:1})]),u("div",Ce,[l(s,{size:"small",onClick:w},{default:o(()=>[l(i,null,{default:o(()=>[l(c(me))]),_:1}),e[9]||(e[9]=n(" 刷新 ",-1))]),_:1}),l(s,{size:"small",onClick:U},{default:o(()=>[l(i,null,{default:o(()=>[l(c(fe))]),_:1}),e[10]||(e[10]=n(" 上传 ",-1))]),_:1}),l(s,{size:"small",onClick:S},{default:o(()=>[l(i,null,{default:o(()=>[l(c(ce))]),_:1}),e[11]||(e[11]=n(" 新建文件夹 ",-1))]),_:1})])]),ae((f(),k(W,{data:V.value,stripe:"",style:{width:"100%"},onRowDblclick:G},{default:o(()=>[l(y,{width:"50"},{default:o(a=>[a.row.type==="folder"?(f(),k(i,{key:0,class:"text-yellow-500"},{default:o(()=>[l(c(pe))]),_:1})):(f(),k(i,{key:1,class:"text-blue-500"},{default:o(()=>[l(c(_e))]),_:1}))]),_:1}),l(y,{prop:"name",label:"名称","min-width":"200"},{default:o(a=>[u("span",{class:"cursor-pointer hover:text-blue-600",onClick:g=>$(a.row)},B(a.row.name),9,xe)]),_:1}),l(y,{prop:"size",label:"大小",width:"120"},{default:o(a=>[n(B(a.row.type==="folder"?"-":J(a.row.size)),1)]),_:1}),l(y,{prop:"modifiedTime",label:"修改时间",width:"180"}),l(y,{label:"操作",width:"200"},{default:o(a=>[a.row.type==="file"?(f(),k(s,{key:0,size:"small",onClick:g=>q(a.row)},{default:o(()=>[...e[12]||(e[12]=[n(" 下载 ",-1)])]),_:1},8,["onClick"])):ve("",!0),l(s,{size:"small",onClick:g=>A(a.row)},{default:o(()=>[...e[13]||(e[13]=[n(" 重命名 ",-1)])]),_:1},8,["onClick"]),l(s,{size:"small",type:"danger",onClick:g=>K(a.row)},{default:o(()=>[...e[14]||(e[14]=[n(" 删除 ",-1)])]),_:1},8,["onClick"])]),_:1})]),_:1},8,["data"])),[[le,x.value]])]),l(M,{modelValue:_.value,"onUpdate:modelValue":e[2]||(e[2]=a=>_.value=a),title:"上传文件",width:"500px"},{footer:o(()=>[u("span",ze,[l(s,{onClick:e[1]||(e[1]=a=>_.value=!1)},{default:o(()=>[...e[16]||(e[16]=[n("取消",-1)])]),_:1}),l(s,{type:"primary",onClick:L,loading:z.value},{default:o(()=>[...e[17]||(e[17]=[n(" 上传 ",-1)])]),_:1},8,["loading"])])]),default:o(()=>[l(X,{class:"upload-demo",drag:"","auto-upload":!1,"file-list":b.value,"on-change":I,multiple:""},{default:o(()=>[l(i,{class:"el-icon--upload"},{default:o(()=>[l(c(we))]),_:1}),e[15]||(e[15]=u("div",{class:"el-upload__text"},[n(" 将文件拖到此处，或"),u("em",null,"点击上传")],-1))]),_:1},8,["file-list"])]),_:1},8,["modelValue"]),l(M,{modelValue:v.value,"onUpdate:modelValue":e[5]||(e[5]=a=>v.value=a),title:"重命名",width:"400px"},{footer:o(()=>[u("span",Fe,[l(s,{onClick:e[4]||(e[4]=a=>v.value=!1)},{default:o(()=>[...e[18]||(e[18]=[n("取消",-1)])]),_:1}),l(s,{type:"primary",onClick:H},{default:o(()=>[...e[19]||(e[19]=[n("确定",-1)])]),_:1})])]),default:o(()=>[l(ee,null,{default:o(()=>[l(Z,{label:"新名称"},{default:o(()=>[l(Y,{modelValue:C.value,"onUpdate:modelValue":e[3]||(e[3]=a=>C.value=a),placeholder:"输入新的文件名"},null,8,["modelValue"])]),_:1})]),_:1})]),_:1},8,["modelValue"])])}}};export{$e as default};

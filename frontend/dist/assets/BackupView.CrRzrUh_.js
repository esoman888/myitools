import{r as p,o as O,b as q,d as i,e as t,w as l,f as r,g as V,h as C,p as u,k as j,l as A,m as B,i as U,q as J,x as K,y as Q,v as W,E as n,z as S}from"./index.BWLkA7o2.js";const X={class:"flex items-center mb-4"},Y={class:"grid grid-cols-1 lg:grid-cols-2 gap-6"},Z={class:"bg-white rounded-lg shadow-md p-6"},ee={class:"text-xl font-semibold mb-4 flex items-center"},te={class:"bg-white rounded-lg shadow-md p-6"},le={class:"text-xl font-semibold mb-4 flex items-center"},ae={class:"bg-white rounded-lg shadow-md p-6 mt-6"},ne={__name:"BackupView",setup(se){j();const T=A(),a=p({path:"",encrypt:!1,password:""}),d=p({path:"",password:""}),g=p(!1),y=p(!1),v=p(0),_=p(0),b=p(""),h=p(""),k=p([{date:"2023-12-01 14:30:00",path:"/Users/user/Backups/iPhone_20231201_143000",size:"2.5GB",encrypted:!0},{date:"2023-11-28 10:15:00",path:"/Users/user/Backups/iPhone_20231128_101500",size:"2.3GB",encrypted:!1}]),I=()=>{n.info("请选择备份保存路径"),a.value.path="/Users/user/Backups/iPhone_"+new Date().toISOString().slice(0,19).replace(/[-:]/g,"").replace("T","_")},E=()=>{n.info("请选择备份文件路径"),d.value.path="/Users/user/Backups/iPhone_20231201_143000"},N=async()=>{if(!a.value.path){n.error("请选择备份路径");return}if(a.value.encrypt&&!a.value.password){n.error("请输入备份密码");return}try{g.value=!0,v.value=0,b.value="";const o=setInterval(()=>{v.value+=10,v.value>=100&&(clearInterval(o),b.value="success",n.success("备份完成"),g.value=!1,k.value.unshift({date:new Date().toLocaleString(),path:a.value.path,size:"2.4GB",encrypted:a.value.encrypt}))},500)}catch(o){g.value=!1,b.value="exception",n.error("备份失败: "+o.message)}},R=async()=>{if(!d.value.path){n.error("请选择备份路径");return}if(await S.confirm("恢复操作将覆盖设备上的所有数据，是否继续？","警告",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).catch(()=>!1))try{y.value=!0,_.value=0,h.value="";const e=setInterval(()=>{_.value+=8,_.value>=100&&(clearInterval(e),h.value="success",n.success("恢复完成"),y.value=!1)},600)}catch(e){y.value=!1,h.value="exception",n.error("恢复失败: "+e.message)}},D=o=>{d.value.path=o.path,o.encrypted&&n.info("该备份已加密，请输入密码")},F=async o=>{if(await S.confirm(`确定要删除备份 "${o.path}" 吗？`,"确认删除",{confirmButtonText:"删除",cancelButtonText:"取消",type:"warning"}).catch(()=>!1)){const f=k.value.indexOf(o);f>-1&&(k.value.splice(f,1),n.success("备份已删除"))}},G=()=>{T.push("/")};return O(()=>{}),(o,e)=>{const f=r("el-icon"),c=r("el-button"),x=r("el-input"),m=r("el-form-item"),L=r("el-switch"),z=r("el-form"),P=r("el-progress"),w=r("el-table-column"),M=r("el-tag"),$=r("el-table");return B(),q("div",null,[i("div",X,[t(c,{onClick:G,type:"default",size:"small",class:"mr-2"},{default:l(()=>[t(f,null,{default:l(()=>[t(U(J))]),_:1}),e[5]||(e[5]=u(" 返回 ",-1))]),_:1}),e[6]||(e[6]=i("h2",{class:"text-2xl font-bold"},"备份与恢复",-1))]),i("div",Y,[i("div",Z,[i("h3",ee,[t(f,{class:"mr-2"},{default:l(()=>[t(U(K))]),_:1}),e[7]||(e[7]=u(" 设备备份 ",-1))]),t(z,{model:a.value,"label-width":"100px"},{default:l(()=>[t(m,{label:"备份路径"},{default:l(()=>[t(x,{modelValue:a.value.path,"onUpdate:modelValue":e[0]||(e[0]=s=>a.value.path=s),placeholder:"选择备份保存路径",readonly:""},{append:l(()=>[t(c,{onClick:I},{default:l(()=>[...e[8]||(e[8]=[u("选择路径",-1)])]),_:1})]),_:1},8,["modelValue"])]),_:1}),t(m,{label:"加密备份"},{default:l(()=>[t(L,{modelValue:a.value.encrypt,"onUpdate:modelValue":e[1]||(e[1]=s=>a.value.encrypt=s)},null,8,["modelValue"])]),_:1}),a.value.encrypt?(B(),V(m,{key:0,label:"备份密码"},{default:l(()=>[t(x,{modelValue:a.value.password,"onUpdate:modelValue":e[2]||(e[2]=s=>a.value.password=s),type:"password",placeholder:"输入备份密码","show-password":""},null,8,["modelValue"])]),_:1})):C("",!0),t(m,null,{default:l(()=>[t(c,{type:"primary",onClick:N,loading:g.value,disabled:!a.value.path},{default:l(()=>[...e[9]||(e[9]=[u(" 开始备份 ",-1)])]),_:1},8,["loading","disabled"])]),_:1})]),_:1},8,["model"]),v.value>0?(B(),V(P,{key:0,percentage:v.value,status:b.value,class:"mt-4"},null,8,["percentage","status"])):C("",!0)]),i("div",te,[i("h3",le,[t(f,{class:"mr-2"},{default:l(()=>[t(U(Q))]),_:1}),e[10]||(e[10]=u(" 设备恢复 ",-1))]),t(z,{model:d.value,"label-width":"100px"},{default:l(()=>[t(m,{label:"备份路径"},{default:l(()=>[t(x,{modelValue:d.value.path,"onUpdate:modelValue":e[3]||(e[3]=s=>d.value.path=s),placeholder:"选择备份文件路径",readonly:""},{append:l(()=>[t(c,{onClick:E},{default:l(()=>[...e[11]||(e[11]=[u("选择路径",-1)])]),_:1})]),_:1},8,["modelValue"])]),_:1}),t(m,{label:"备份密码"},{default:l(()=>[t(x,{modelValue:d.value.password,"onUpdate:modelValue":e[4]||(e[4]=s=>d.value.password=s),type:"password",placeholder:"输入备份密码（如果有）","show-password":""},null,8,["modelValue"])]),_:1}),t(m,null,{default:l(()=>[t(c,{type:"danger",onClick:R,loading:y.value,disabled:!d.value.path},{default:l(()=>[...e[12]||(e[12]=[u(" 开始恢复 ",-1)])]),_:1},8,["loading","disabled"])]),_:1})]),_:1},8,["model"]),_.value>0?(B(),V(P,{key:0,percentage:_.value,status:h.value,class:"mt-4"},null,8,["percentage","status"])):C("",!0)])]),i("div",ae,[e[15]||(e[15]=i("h3",{class:"text-xl font-semibold mb-4"},"备份历史",-1)),t($,{data:k.value,stripe:"",style:{width:"100%"}},{default:l(()=>[t(w,{prop:"date",label:"备份时间",width:"180"}),t(w,{prop:"path",label:"备份路径"}),t(w,{prop:"size",label:"大小",width:"120"}),t(w,{prop:"encrypted",label:"是否加密",width:"100"},{default:l(s=>[t(M,{type:s.row.encrypted?"success":"info"},{default:l(()=>[u(W(s.row.encrypted?"是":"否"),1)]),_:2},1032,["type"])]),_:1}),t(w,{label:"操作",width:"150"},{default:l(s=>[t(c,{size:"small",onClick:H=>D(s.row)},{default:l(()=>[...e[13]||(e[13]=[u(" 恢复 ",-1)])]),_:1},8,["onClick"]),t(c,{size:"small",type:"danger",onClick:H=>F(s.row)},{default:l(()=>[...e[14]||(e[14]=[u(" 删除 ",-1)])]),_:1},8,["onClick"])]),_:1})]),_:1},8,["data"])])])}}};export{ne as default};
